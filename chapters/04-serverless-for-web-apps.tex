\chapter{Serverless architecture for web applications}

% różne podejścia do budowy aplikacji webowych - jak to przekłada się na architekturę serverless?
% czy można wyznaczyć ogólne wytyczne pozwalające na efektywne tworzenie aplikacji webowych w architekturze serverless?
% ---

% reference to previous chapter, how serverless relates to:
% - 1. distributed system - monolith -> microservices -> FaaS as next step
% - 2. database - what are the requirements? consistency vs. availability
% - 3. clients - thin -> thick (-> thin?) -> CDN / Lambda@Edge to render static pages, 3.5. client/server communication - REST / Websocket / GraphQL - GraphQL using AppSync

% Serverless should be sufficient for what's needed to develop modern web application 

% 1. Server

% - Serverless - event-driven architecture, require building application compliant with that approach

% ---

% - What if processing is not compliant? - hybrid solution?
% - what with limitations? - interactive clients, low latency / "real-time" 

% 2. Database

% - "Classic" databases are not suitable for serverless architecture - needs redefinition - DynamoDB, Aurora - investigation how these works? how does these affects the application development?
% - functions are stateless - 3rd party components to persist state

% 3. Clients 

% - does not change much or does it?
% - how serverless (cdn, static site rendering using lambda@edge) can be used to make it better?
% - sdk/libraries for building clients

% ---

% % How to leverage serverless computing for developing web applications?
% % Types of processing not suitable for serverless computing?
% % https://aws.amazon.com/lambda/resources/reference-architectures/
% % https://docs.aws.amazon.com/whitepapers/latest/modern-application-development-on-aws/modern-application-development-on-aws.pdf
% % https://www.thoughtworks.com/insights/blog/traits-serverless-architecture

% ---

% - A Review of Serverless Use Cases and their Characteristics
% - LEVERAGING SERVERLESS CLOUD COMPUTING ARCHITECTURES
% - Patterns for Serverless Functions (Function-as-a-Service): A Multivocal Literature Review

% % Migrating a web application to serverless architecture - serverless design patterns in more details
% % https://jyx.jyu.fi/bitstream/handle/123456789/64836/URN%3ANBN%3Afi%3Ajyu-201906253422.pdf?sequence=1

% ---

% Research Questions:

% 1. Is Faas appropriate approach for building web applications - lower cons, better reliability, better performance
% - FaaS serverless as Backend ~ Microservices

% \cite{BerkeleyServerless}
% 3 Limitations of Today’s Serverless Computing Platforms

% - can serverless handle some finer grained communication - comparing to the serverfull solution? - drawing / excalidraw like

% \cite{LeveragingServerlessCloudComputingArchitectures}
% - These serverless computing services enable creating microservices, without the need to manage servers, that can easily be deployed and are automatically scaled

% ---

% 2. Database for serverless - communicating with database

% \cite{BerkeleyServerless}
% Serverless SQLite: Databases

% ---

% 3. Client

% - websockets / real-time communication / pushing update to the client - push to pull pattern - as being sustainable to be implemented utilising lambdas

% ---

% 4. Design patterns / good practice
% - basic approach / FaaS -> optimised FaaS

% ---

% % Mikhail Shilkov - interesting blog around serverless, AWS, Azure, Pulumi
% % - https://mikhail.io/serverless/coldstarts/big3/

% ---

\section{Intro}

Describe how serverless relate to microservices?

\begin{enumerate}
    \item multiple components combined to perform application logic
    \item event driven - triggers other components, lambda for transforming the data
    \item scaling independent components
    \item ...
\end{enumerate}

Research questions:

\begin{enumerate}
    \item Is Faas appropriate approach for building web applications (FaaS serverless as Backend similar Microservices)? - lower cont, better reliability, better performance
    \item Server tier?
    \item Database for serverless - communicating with database
    \item Client
    \item Design patterns and good practice (basic approach / FaaS -> optimised FaaS)
\end{enumerate}

why AWS? how the research looks like?

\section{Is Faas appropriate approach for building web applications?}

how serverless fulfills the requirements put in front of the web applications?

---

better performance

\begin{itemize}
    \item cold starts - pre-warming functions, provisioned concurrency
    \item serverless usually should not be faster than serverful
    \item utilising parallel execution for faster processing of the tasks (regarding the latex parsing - splitting into chunks that can be parsed together)
\end{itemize}

better reliability

\begin{itemize}
    \item implicit failover
    \item DLQ in SQS and others?
\end{itemize}

and so on

---

lower cost

\begin{itemize}
    \item some types of processing are not sufficient - \cite{BerkeleyServerless}
    \item some types of processing can be redesigned to leverage benefits of serverless - \cite{BerkeleyServerless}
    \item calculating betteruptime.com on FaaS - more expensive than serverful on AWS, which is more expensive than VPS somewhere else
    \item conditions/characteristics/decission tree - when serverless will be more expensive
\end{itemize}

---

examples

\begin{itemize}
    \item small web app - processing receipts/invoices
    \item event driven processing - parsing latex files to interactive presentations
\end{itemize}

\section{Server Tier}

\begin{itemize}
    \item serverless processing characteristics - event driven - lambdas for transforming data
    \item distributed sagas - step functions
    \item good practices - using SQS for batching, streams from DynamoDB, using the lambda only to transform the data
\end{itemize}

\section{Database Tier}

\begin{itemize}
    \item relational database not suitable for serverless - RDS proxy holding connections
    \item DynamoDB, Aurora - how they work?
    \item DynamoDB modeling? single table design - cost savings, increase performance
\end{itemize}

\section{Clients}

\begin{itemize}
    \item APIGateway - REST + websockets
    \item AppSync - GraphQL
    \item serverless loves async processing - push to pull pattern - pushing update to client
    \item hosting static website from S3 + CloudFront - hosting client
\end{itemize}

\section{Desing patterns and good practices}

---

\section{Notes}

% TODO:rb :eyes:
% https://aws.amazon.com/blogs/compute/building-well-architected-serverless-applications-controlling-serverless-api-access-part-1/
% https://www.serverless.com/blog/how-create-rest-api-serverless-components
% https://www.andmore.dev/blog/build-serverless-api-with-no-lambda/

% ---

% - https://www.serverless.com/blog/amazon-rds-proxy
% - https://www.jeremydaly.com/serverless-microservice-patterns-for-aws/?utm_source=sidebar
% - Ticket to ride - based on the Appsync + direct resolvers writing to DynamoDB to persist state + subscriptions for live update
% - https://awsfeed.com/whats-new/serverless/how-i-scaled-an-appsync-project-to-200-resolvers
% - https://www.youtube.com/watch?v=Cs5e9vbjNdU
% - https://aws.amazon.com/blogs/mobile/appsync-pipeline-resolvers-3/
% - https://aws.amazon.com/blogs/mobile/integrating-aws-appsync-neptune-elasticache/

\subsubsection*{Microservices vs Serverless: A Performance Comparison on a Cloud-native Web Application}

- microservices - agility, scalability, resiliency
- serverless - offloads management and server configuration from user to provider

- research - performance comparison in terms of: scalability, reliability, cost, latency
- shows that neither serverless, nor microservices fits all the scenarios - advantages under different scenarios
- microservices has benefits for long-lasting services over serverless
- large size response - more suitable for serverless

microservices
- monolith to microservice migration for better agility
- only teams with strong devops culture get benefits of microservice architecture
- each modules dedicated to specific business role, communicates via well defined interface
- advantages: improved fault tolerance, flexibility of using tehcnologies, scalability and speed up of the applications
- disadvantages: increased development and deployment complexity, implementing communication between services, end-to-end testing
- using containerisation deployment - higher deployemnt speed, agility and lower resource consumption

serverless
- releases the need fo managing the servers, devs can focus on development instead of infra management
- serverless cost based on number of requests and the time it takes to execute

- does not require management of the underlying infrastructure - executing, infra management, operations, autoscaling and maintenance handled by the provider
- billing per function execution and tim it requires to run it - lower cost of ownership and pay as you go model
- serverless platform accepts application code and deployment specification and uses it for further execution
- all major developers include frameworks to develop the apps in serverless env, local env for testing and debugging, gathering logs and distributed tracing based on the request id

- not only migrating from microservices, but also considering where to migrate - microservices or serverless
- (Jambunathan and Yoganathan) - architecture decissions between microservices and serverless
- serverless - infra restrictions, must be hosted by cloud providers (vendor lock-in), but auto-scaling, no infra managements, automaitc deployments are the benefit
- microservices - could be deployed on a public and private cloud - no vendor lockin, but reuqires management and handling deployment and scaling

research
- simple app similar to the Toggl - mostly crud operations, 12 API calls
- same database - AWS Aurora, contianer and lambda both 512MB RAM
- load tested using k6, saving results in InfluxDB + Grafana for visualisation
- 12 APIs * load patterns (increasing, random, traingle) * 2 deployment strategies

microservices
- AWS ECS, container orchestration using Docker, 5 services, autoscaling by adding 2 more instances when utilisation above 50\%, removing instances after 1 min when below 30\% of utilisation, dedicated load-balancer
- (\#1 fav projects - get large amoount of data) response time rise with the workload, but after scale-out decreased, peaking response time when starts to scale
- (\#2 timesheets - create, delete, update) better time with the delete operation??? microservices more cost effective than serverless
- (\#3 misc - simpla, small, static requests) better response time

serverless
- AWS Lambda + API Gateway
- (\#1 fav projects) for simple requests - better performance stabilit and scaling-agility, initially "cold starts", better throughput (more request/time), cheaper
- (\#2 timesheets) better performance responsiveness and stability, especially when microservices started to scale, still suffers cold start

conclusions
- serverless - starts - provisioned concurrency, prewarming the lambdas, direct resolvers for simple operations - https://youtu.be/i5NEHwFeeuY
- microservices - load balancing and traffic redistribution problems - (serverless caught cold start initially, but later was stable)
- microservices - better performance when fetching small size and repetitive requests - additionally lower cost compared to serverless
- serverless - more agile in terms of scalability (delays with rebalance from the microservice architectures)

\subsubsection*{Serverless Computing: An Investigation of Deployment Environments for Web APIs}

